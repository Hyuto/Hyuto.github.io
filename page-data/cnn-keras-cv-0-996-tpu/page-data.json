{"componentChunkName":"component---src-templates-blog-post-js","path":"/cnn-keras-cv-0-996-tpu/","result":{"data":{"site":{"siteMetadata":{"title":"Hyuto's Blog"}},"markdownRemark":{"id":"20ac24b9-a52d-51d4-be97-2e3ed610e572","excerpt":"This notebook is basically my notebook run on kaggle so if you want to try\nand run the code with same environment as mine go to link bellow. Kaggle Notebookâ€¦","html":"<p>This notebook is basically my notebook run on <a href=\"https://www.kaggle.com/\">kaggle</a> so if you want to try\nand run the code with same environment as mine go to link bellow.</p>\n<p>Kaggle Notebook : <a href=\"https://www.kaggle.com/wahyusetianto/cnn-keras-cv-0-996-tpu\">CNN Keras CV - 0.996 [TPU]</a></p>\n<p>P.S. Donâ€™t forget to <em>upvote</em> if you like it ðŸ˜Š.</p>\n<h1>Overview</h1>\n<p>This kernel is on purpose to build model for MNIST digits dataset. In this kernel weâ€™re gonna do some preprocessing then make augmentation datagen so our model didnâ€™t train on the same image data, then at each of our model(here we use 15 folds so there will be 15 models) to make prediction for test dataset and by the end weâ€™re gonna do ensembles for the prediction.</p>\n<h1>Train on TPU!!</h1>\n<p>why? Because itâ€™s <strong>faster</strong>. While people usually train on GPU for image related things, in this notebook we try to do things on TPU and see how it affect the Accuracy.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> random\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">from</span> timeit <span class=\"token keyword\">import</span> default_timer\n<span class=\"token keyword\">from</span> sklearn<span class=\"token punctuation\">.</span>model_selection <span class=\"token keyword\">import</span> KFold\n\n<span class=\"token comment\"># Plot</span>\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n<span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns\n\n<span class=\"token comment\"># Tensorflow and Keras</span>\n<span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\n<span class=\"token keyword\">from</span> tensorflow <span class=\"token keyword\">import</span> keras\n<span class=\"token keyword\">import</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>backend <span class=\"token keyword\">as</span> K\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>utils <span class=\"token keyword\">import</span> to_categorical\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Sequential<span class=\"token punctuation\">,</span> load_model\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>layers <span class=\"token keyword\">import</span> Dense<span class=\"token punctuation\">,</span> Dropout<span class=\"token punctuation\">,</span> Flatten<span class=\"token punctuation\">,</span> Conv2D\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>layers <span class=\"token keyword\">import</span> MaxPool2D<span class=\"token punctuation\">,</span> BatchNormalization\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>preprocessing<span class=\"token punctuation\">.</span>image <span class=\"token keyword\">import</span> ImageDataGenerator\n<span class=\"token keyword\">from</span> tensorflow<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>callbacks <span class=\"token keyword\">import</span> LearningRateScheduler<span class=\"token punctuation\">,</span> ModelCheckpoint\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Using Tensorflow Version : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>tf<span class=\"token punctuation\">.</span>__version__<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Using Keras Version      : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>keras<span class=\"token punctuation\">.</span>__version__<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Using Tensorflow Version : 2.2.0\nUsing Keras Version      : 2.3.0-tf</code></pre></div>\n<h1>Load the Data</h1>\n<p>Load the MNIST data</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">train <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'../input/digit-recognizer/train.csv'</span><span class=\"token punctuation\">)</span>\ntest <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'../input/digit-recognizer/test.csv'</span><span class=\"token punctuation\">)</span>\ntrain<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">5 rows Ã— 785 columns</code></pre></div>\n<h1>Preprocess</h1>\n<h2>1. Specifying X and y</h2>\n<p>for y we need to encode to one hot vector. In keras we have function <code class=\"language-text\">to_categorical</code> for this.</p>\n<p>Example :</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">y = [1, 0, 4]\nto_categorical(y)\n\n# Output:\n[\n [0,1,0,0,0], # 1\n [1,0,0,0,0], # 0\n [0,0,0,0,1], # 4\n]</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Specifying X and y</span>\nX <span class=\"token operator\">=</span> train<span class=\"token punctuation\">.</span>drop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'label'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> axis <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\ny <span class=\"token operator\">=</span> to_categorical<span class=\"token punctuation\">(</span>train<span class=\"token punctuation\">[</span><span class=\"token string\">'label'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">)</span> <span class=\"token comment\"># To Categorical y</span></code></pre></div>\n<h2>2. Normalizing Images</h2>\n<p>Data normalization is an important step to ensures that each input parameter (pixel, in this case) has a similar data distribution. This makes convergence faster while training the network.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Normalize</span>\nX <span class=\"token operator\">=</span> X <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\nX_test <span class=\"token operator\">=</span> test <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span></code></pre></div>\n<h2>3. Reshape</h2>\n<p>Train and test images (28px x 28px) has been stock into pandas. Dataframe as 1D vectors of 784 values. We reshape all data to 28x28x1 3D matrices.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Reshape Array</span>\nX <span class=\"token operator\">=</span> X<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nX_test <span class=\"token operator\">=</span> X_test<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Letâ€™s take a look at our data</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">fig<span class=\"token punctuation\">,</span> axes <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>subplots<span class=\"token punctuation\">(</span>ncols<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> nrows<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> figsize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ninit <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    j <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        ind <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>choices<span class=\"token punctuation\">(</span>train<span class=\"token punctuation\">.</span>label<span class=\"token punctuation\">[</span>train<span class=\"token punctuation\">.</span>label <span class=\"token operator\">==</span> init<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">,</span> k <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n        init <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">while</span> j <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ind<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> k<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">[</span>ind<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cmap<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span>binary<span class=\"token punctuation\">)</span>\n            axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> k<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token string\">'off'</span><span class=\"token punctuation\">)</span>\n            j <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        j <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nfig<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0995ecc1e7de346086519e39d71607ea/cc488/output_12_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADBElEQVQozxWS3VPiVgDF869Xtzq7XTu7+1B37IMz4kpgpUZnG7aZKhgRhQQDCIR8EGgwueTrkhByEyaB28n775w558wh2u32axiGZLPZHGRZVqEoqj+fz8nRaCQlSfK93W4rcRwXJ5OJGEVRxfO81+VyWXIcp79er/+CEA4AAH8jhB4URekTz8/PQJblnzzPW/1+/+7k5MS0bfsnx3EQQvhvo9HwN5tNVZZlZ7Va3em6DrbbLaPrupll2Z2iKAuEUFNRlKHruoAQBKEEADjgeb4MAPggSRIZx/GBqqoVjPH7l5eXq81mcyAIwnfLsj64rktijA91XSdN0/wtDMOSqqqfkiT5M9cSxWIxGo/HD6enp8iyrNbV1VVo2/YDTdOp4zhNkiS3q9WKvbi42Hie15pOp+s4jhvD4TDMeZ7nc32/0+noPM+viSRJClEU7bmue75arQ4AAGfb7XYPQlhcLBbvDMMoxXH8i67rFxjjg5xHCO0HQXCWN/F9v4Ax/mhZ1h+maZ4RNE3jKIo6giDgbrf7enx8jCVJ6pTLZRwEQY9hGAwh5HNusVi8DodD7HmeMBqNsGmag9lshgEAqiiKHsdxmJhOp+e73W7fNM1v+Tbdbrdg2/a+ruulLMt+dV23nKbp3mQyKZqmeZg32e1278IwLKRpehgEwTfP845Go9GxZVnnBM/zvizLNZIkA9/3H2mahgihWqFQQMvlkm21WglC6I5l2bWmaQ2WZZeaptXH4zFUVfUxf8FgMOh0Op1JvV5fEpqmXWuadsRx3A2E8HOv16PSND2iKIre7XafFEWpRlH0UVXVH0mSfJZl+TqKot8dx6Ewxl8Mw7gxDOPrfD4vvL29XROz2UzDGOem0/V6Td/f36tJklD1ev0tDMMf1WrVsCyLEkXxvyiK6DwJhPCmUqmoDMPQiqJos9ks/yPPsuwkT2j6vl+VJAkEQXBbq9WMNE2rDMO4nucxl5eXMMsymuM4GyF022q1TNd1/6Eoynh6eroVRRE4jvPY6/UGsiwb/wOjpOMVzbCcsQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/0995ecc1e7de346086519e39d71607ea/f058b/output_12_0.png\"\n        srcset=\"/static/0995ecc1e7de346086519e39d71607ea/c26ae/output_12_0.png 158w,\n/static/0995ecc1e7de346086519e39d71607ea/6bdcf/output_12_0.png 315w,\n/static/0995ecc1e7de346086519e39d71607ea/f058b/output_12_0.png 630w,\n/static/0995ecc1e7de346086519e39d71607ea/cc488/output_12_0.png 928w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>as you can see there some nice &#x26; bad hand written digits number at our dataset.</p>\n<h1>Data Augmentation</h1>\n<p>we currently have about 42000 image data, letâ€™s multiply that value by doing some soft augmentation.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">datagen <span class=\"token operator\">=</span> ImageDataGenerator<span class=\"token punctuation\">(</span>rotation_range<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n                             zoom_range <span class=\"token operator\">=</span> <span class=\"token number\">0.10</span><span class=\"token punctuation\">,</span>\n                             width_shift_range<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span>\n                             height_shift_range<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>letâ€™s take a look on our Augmentation datagen</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">AUG_test</span><span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    fig<span class=\"token punctuation\">,</span> axes <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>subplots<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> figsize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    axes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cmap<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span>binary<span class=\"token punctuation\">)</span>\n    axes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>set_title<span class=\"token punctuation\">(</span><span class=\"token string\">'Actual'</span><span class=\"token punctuation\">)</span>\n    axes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token string\">'off'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        aug<span class=\"token punctuation\">,</span> _ <span class=\"token operator\">=</span> datagen<span class=\"token punctuation\">.</span>flow<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>aug<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span><span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>cmap<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span>binary<span class=\"token punctuation\">)</span>\n        axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>set_title<span class=\"token punctuation\">(</span><span class=\"token string\">'Augmented'</span><span class=\"token punctuation\">)</span>\n        axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token string\">'off'</span><span class=\"token punctuation\">)</span>\n    fig<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">AUG_test<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/710183c6067410e8862ad6a60e749cd2/3d4b6/output_18_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABPklEQVQY0zWPwUsCURDG908KokuXDh27RYfskuXfE54CxYuXlA6BmBIqhRt4adNyfT1SWFAQBDVCAtd1ffOLF3aZ+Wa+b+abcbTWifF4fAYcAntKqYTruqnFYnEK7M7n86Nms5kKgiAZhuEBsO95XlIpddHv94+BneFweNJqtS611ucOQLvdRin1DTRtHccx3W7XwkcR+bHA933W67UG3m1dr9f/Nfc2hGEo1WoVJwgC0uk0xpgJ0LBkNpuNPc+z8AH40lpLoVBgu+ylXC5TLBZjIDLG3AGSy+WiTqeDk8lkmM1mVrwAnhuNBnZge+kTsMzn80wm1o/P6XTq12q1P15EbKoMBgNKpdJfzxmNRr513mw2j0Cm1+t1V6vV6/aa6+Vy6VYqlQ7wYYy5BW4sFpFXEbFvXEVR9CYiL9bwF7WcWuUXOXHlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/710183c6067410e8862ad6a60e749cd2/f058b/output_18_0.png\"\n        srcset=\"/static/710183c6067410e8862ad6a60e749cd2/c26ae/output_18_0.png 158w,\n/static/710183c6067410e8862ad6a60e749cd2/6bdcf/output_18_0.png 315w,\n/static/710183c6067410e8862ad6a60e749cd2/f058b/output_18_0.png 630w,\n/static/710183c6067410e8862ad6a60e749cd2/3d4b6/output_18_0.png 712w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>Build CNN Model</h1>\n<p>The CNNâ€™s in this kernel follow LeNet5â€™s design on <a href=\"https://www.kaggle.com/cdeotte\">Chris Deotte</a> kernel <a href=\"https://www.kaggle.com/cdeotte/25-million-images-0-99757-mnist\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">build_model</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    model <span class=\"token operator\">=</span> Sequential<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">,</span>\n                     input_shape <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> strides<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> padding<span class=\"token operator\">=</span><span class=\"token string\">'same'</span><span class=\"token punctuation\">,</span>\n                     activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dropout<span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> strides<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> padding<span class=\"token operator\">=</span><span class=\"token string\">'same'</span><span class=\"token punctuation\">,</span>\n                     activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dropout<span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Conv2D<span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span> kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>BatchNormalization<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Flatten<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dropout<span class=\"token punctuation\">(</span><span class=\"token number\">0.4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'softmax'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    model<span class=\"token punctuation\">.</span><span class=\"token builtin\">compile</span><span class=\"token punctuation\">(</span>optimizer<span class=\"token operator\">=</span><span class=\"token string\">\"adam\"</span><span class=\"token punctuation\">,</span> loss<span class=\"token operator\">=</span><span class=\"token string\">\"categorical_crossentropy\"</span><span class=\"token punctuation\">,</span>\n                  metrics<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"accuracy\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> model</code></pre></div>\n<h1>Detect and Instantiate TPU Distribution Strategy</h1>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># detect and init the TPU</span>\ntpu <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>distribute<span class=\"token punctuation\">.</span>cluster_resolver<span class=\"token punctuation\">.</span>TPUClusterResolver<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntf<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>experimental_connect_to_cluster<span class=\"token punctuation\">(</span>tpu<span class=\"token punctuation\">)</span>\ntf<span class=\"token punctuation\">.</span>tpu<span class=\"token punctuation\">.</span>experimental<span class=\"token punctuation\">.</span>initialize_tpu_system<span class=\"token punctuation\">(</span>tpu<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># instantiate a distribution strategy</span>\ntpu_strategy <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>distribute<span class=\"token punctuation\">.</span>experimental<span class=\"token punctuation\">.</span>TPUStrategy<span class=\"token punctuation\">(</span>tpu<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Config</span>\nEPOCHS <span class=\"token operator\">=</span> <span class=\"token number\">45</span>\nBATCH_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">16</span> <span class=\"token operator\">*</span> tpu_strategy<span class=\"token punctuation\">.</span>num_replicas_in_sync</code></pre></div>\n<h1>Training</h1>\n<p>Here we use Kfold CV to split our data by 15 and build model at each fold. At the callbacks we use <code class=\"language-text\">f(x) = 1e-3 * 0.95 ** x</code> for our LR Scheduler and do Checkpoint at best <code class=\"language-text\">val_acc</code> score.</p>\n<p>Note that Tensorflow distribution strategy havenâ€™t supported ImageDataGenerator by this <a href=\"https://github.com/tensorflow/tensorflow/issues/34346\">issue</a> so instead use that at <code class=\"language-text\">fit_generator</code> we just have to extract Augmentation data by looping through and done training by <code class=\"language-text\">fit</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Init</span>\nscores<span class=\"token punctuation\">,</span> History <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\npred <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>shape <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># CV</span>\ncv <span class=\"token operator\">=</span> KFold<span class=\"token punctuation\">(</span>n_splits<span class=\"token operator\">=</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span> shuffle <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> random_state <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> fold<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>train_index<span class=\"token punctuation\">,</span> val_index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>cv<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span>X<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    start <span class=\"token operator\">=</span> default_timer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Clear Session</span>\n    K<span class=\"token punctuation\">.</span>clear_session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    tf<span class=\"token punctuation\">.</span>tpu<span class=\"token punctuation\">.</span>experimental<span class=\"token punctuation\">.</span>initialize_tpu_system<span class=\"token punctuation\">(</span>tpu<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Splitting</span>\n    X_train <span class=\"token punctuation\">,</span> y_train <span class=\"token operator\">=</span> X<span class=\"token punctuation\">[</span>train_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">[</span>train_index<span class=\"token punctuation\">]</span>\n    X_val<span class=\"token punctuation\">,</span> y_val <span class=\"token operator\">=</span> X<span class=\"token punctuation\">[</span>val_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">[</span>val_index<span class=\"token punctuation\">]</span>\n\n    <span class=\"token comment\"># Augmentation</span>\n    Train_x<span class=\"token punctuation\">,</span> Train_y <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span>\n    batch <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> x_batch<span class=\"token punctuation\">,</span> y_batch <span class=\"token keyword\">in</span> datagen<span class=\"token punctuation\">.</span>flow<span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span>\n                                         batch_size<span class=\"token operator\">=</span>BATCH_SIZE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> batch <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            Train_x<span class=\"token punctuation\">,</span> Train_y <span class=\"token operator\">=</span> x_batch<span class=\"token punctuation\">,</span> y_batch\n        <span class=\"token keyword\">elif</span> batch <span class=\"token operator\">>=</span> X<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">//</span> BATCH_SIZE<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">break</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            Train_x <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>concatenate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Train_x<span class=\"token punctuation\">,</span> x_batch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            Train_y <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>concatenate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Train_y<span class=\"token punctuation\">,</span> y_batch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        batch <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n\n    <span class=\"token comment\"># Model</span>\n    <span class=\"token keyword\">with</span> tpu_strategy<span class=\"token punctuation\">.</span>scope<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> build_model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Callbacks</span>\n    annealer <span class=\"token operator\">=</span> LearningRateScheduler<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token number\">1e</span><span class=\"token operator\">-</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.95</span> <span class=\"token operator\">**</span> x<span class=\"token punctuation\">)</span> <span class=\"token comment\"># LR</span>\n    sv <span class=\"token operator\">=</span> ModelCheckpoint<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Model Fold </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>fold<span class=\"token punctuation\">}</span></span><span class=\"token string\">.h5'</span></span><span class=\"token punctuation\">,</span> monitor<span class=\"token operator\">=</span><span class=\"token string\">'val_accuracy'</span><span class=\"token punctuation\">,</span>\n                         save_best_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> mode<span class=\"token operator\">=</span><span class=\"token string\">'max'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Training</span>\n    history <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>Train_x<span class=\"token punctuation\">,</span> Train_y<span class=\"token punctuation\">,</span> batch_size <span class=\"token operator\">=</span> BATCH_SIZE<span class=\"token punctuation\">,</span>\n                        epochs <span class=\"token operator\">=</span> EPOCHS<span class=\"token punctuation\">,</span> verbose <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> callbacks<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>annealer<span class=\"token punctuation\">,</span> sv<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        steps_per_epoch <span class=\"token operator\">=</span> X_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">//</span>BATCH_SIZE<span class=\"token punctuation\">,</span>\n                        validation_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>X_val<span class=\"token punctuation\">,</span> y_val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    History<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Load best model</span>\n    model <span class=\"token operator\">=</span> load_model<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Model Fold </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>fold<span class=\"token punctuation\">}</span></span><span class=\"token string\">.h5'</span></span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Evaluate</span>\n    score <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>evaluate<span class=\"token punctuation\">(</span>X_val<span class=\"token punctuation\">,</span> y_val<span class=\"token punctuation\">,</span> verbose <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    scores<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Making Prediction</span>\n    pred <span class=\"token operator\">+=</span> model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span>\n\n    time <span class=\"token operator\">=</span> <span class=\"token builtin\">round</span><span class=\"token punctuation\">(</span>default_timer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'[INFO] Fold </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>fold <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> val_accuracy : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token builtin\">round</span><span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> - Time : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>time<span class=\"token punctuation\">}</span></span><span class=\"token string\"> s'</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'[INFO] Mean CV scores : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token builtin\">round</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>scores<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>scores<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[INFO] Fold 1 val_accuracy : 0.9961 - Time : 168.7797 s\n[INFO] Fold 2 val_accuracy : 0.9957 - Time : 173.7161 s\n[INFO] Fold 3 val_accuracy : 0.9986 - Time : 178.845 s\n[INFO] Fold 4 val_accuracy : 0.9957 - Time : 174.5829 s\n[INFO] Fold 5 val_accuracy : 0.9946 - Time : 173.8493 s\n[INFO] Fold 6 val_accuracy : 0.9979 - Time : 175.585 s\n[INFO] Fold 7 val_accuracy : 0.9964 - Time : 176.5861 s\n[INFO] Fold 8 val_accuracy : 0.9968 - Time : 177.6894 s\n[INFO] Fold 9 val_accuracy : 0.995 - Time : 179.8059 s\n[INFO] Fold 10 val_accuracy : 0.9943 - Time : 176.4369 s\n[INFO] Fold 11 val_accuracy : 0.9939 - Time : 182.6052 s\n[INFO] Fold 12 val_accuracy : 0.9961 - Time : 177.0005 s\n[INFO] Fold 13 val_accuracy : 0.995 - Time : 180.026 s\n[INFO] Fold 14 val_accuracy : 0.9954 - Time : 179.1445 s\n[INFO] Fold 15 val_accuracy : 0.9975 - Time : 175.2097 s\n\n[INFO] Mean CV scores : 0.9959</code></pre></div>\n<p>And so weâ€™ve got really great CV score there. Letâ€™s check the Training History.</p>\n<h1>History</h1>\n<p><strong>Validation Loss</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7422a0fae641ba551fdb715a86950450/302a4/val_loss.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB6klEQVQ4y6WT6XLbMAyE+/7Pl2mnmTpObEuWdVKUeJP6OmTiK/1ZaDArQOAKJBc/tm0jW0qJGOMThhCoqoqmaajruriUkrym1MSIDwHnPVeeH1cyrTXeW7TVxPhF+oXZM3n2EofPXCZR68K5rgkh3gnzR2sdwa/088DV4hZv796GglvaCO6ed9rStS0hhscOI84HZnGhOb5gQsQ6y+rXUpjdmETIxxEiRodCTAS1Kuq6Kt3fCLeUMNYyjzXt20/25z3VNDAukk4PaK24TAOHYUKsK51U9Iumyy4Fp9PpmTCmiDWWufmg3/3i+L6jb2uOh4pDfeHSCY6XE+00Fx+1RAjJOE5oZVm1IT5uOZ9h7nDpBGL3G3Vq8E2F37/Svu2o397xQ4MbWmxfE9oTrs1YMR//YLUipvSw5W3D5i3Pgu5jz9icmcaJrukZ63e61xfmpkUeT4yHM2JYmMeJZRRoKQnelKaeZGONwbgVoUbMuuD1gl0EVgqMNqyjQA0dS98hhwEjJ8wqUKIlOkP4TqiNIeVnSyxWYkKOIyZa/OaxUWOdLj91waDtijES7RTO2387zMIO/lO41ltccEU6zjuMM0Xsyip89CUXiuBTWet9uN/y4+j54G9TkW6YbhPyHb2/1z+N3jX4X8s8fwHNYfM7HIlj8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"val-loss\"\n        title=\"val-loss\"\n        src=\"/static/7422a0fae641ba551fdb715a86950450/f058b/val_loss.png\"\n        srcset=\"/static/7422a0fae641ba551fdb715a86950450/c26ae/val_loss.png 158w,\n/static/7422a0fae641ba551fdb715a86950450/6bdcf/val_loss.png 315w,\n/static/7422a0fae641ba551fdb715a86950450/f058b/val_loss.png 630w,\n/static/7422a0fae641ba551fdb715a86950450/40601/val_loss.png 945w,\n/static/7422a0fae641ba551fdb715a86950450/302a4/val_loss.png 1080w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Validation Accuracy</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db083aad0563651af90980c4e8ae20ae/302a4/val_accuracy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABvklEQVQ4y6WTfW/bIBCH+/2/1/6vlqzNqrROHWNTNzZ2/AIY8DPZmb1kq6pNOwkh7uDh7vhxN44jk4UQ8N6vYzKlFEmSkOc5QghkJpFSrnuC/3Vm4dwtsL7v1+DgB6yzs18Pmt52OO/Qg6E1DdYNc8z6YU3EOXcL1EYTxoANlqavZ6AJlt5pjLOoqqY4lVRlRVXX1FWJqgvObYWzw1rVCrTGoE1LISV921PKE+9RTHmUiOeEUki65IU2OdIcj9THhDKNOb1G6LPCh6nk8QpoLUWakWy3iO1X5GaD2n0jftzwdP+FU/ZEkew57B+QMqJMXxCHHad4h+kafAhXGY4jRhvqvCJ9vCc/PCOi7+yTPbGMyfN3RPKCUA2yUhSlQrWat6Ihywt64wh/lGwH+ipHRA9kqiBTJXlV4kbQNnCuW856YKrMmECYE4H6rGm7Du9/exRjLZV6pcgjpm5YH+CihLk3zgbGn326uC6z7luyNL19lElDxhicNzRdO9+8+D8bk02tepPyVjYTXWs9X9oYz7+YtoY0yz7QodZzH7Ud5uAi1s/mOZGuJRWCYQFef71pY/gL0Efgm6+3LP7XJs4PIm3zZreLK4cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"val-accuracy\"\n        title=\"val-accuracy\"\n        src=\"/static/db083aad0563651af90980c4e8ae20ae/f058b/val_accuracy.png\"\n        srcset=\"/static/db083aad0563651af90980c4e8ae20ae/c26ae/val_accuracy.png 158w,\n/static/db083aad0563651af90980c4e8ae20ae/6bdcf/val_accuracy.png 315w,\n/static/db083aad0563651af90980c4e8ae20ae/f058b/val_accuracy.png 630w,\n/static/db083aad0563651af90980c4e8ae20ae/40601/val_accuracy.png 945w,\n/static/db083aad0563651af90980c4e8ae20ae/302a4/val_accuracy.png 1080w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>Ensembleing Predictions</h1>\n<p><code class=\"language-text\">argmax</code> through the prediction to get the number of class</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pred <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> pred<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Countplot Prediction</span>\nplt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nsns<span class=\"token punctuation\">.</span>countplot<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">'Countplot of Predictions'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 451px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/331531bb65cc6908f464a6e2e9da132e/38070/output_30_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.9367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAD10lEQVQ4y62Ta0yTZxiG3wnq4lTAP8KSRV1iMv4s2yKJLNkhTA5CoQUMjE4UdbGwEEB0HLYsYGlhC4eICqKlFCi0wEI4CAj0a3WTmhFhBzqzgG1tRmCljQu0/Vpo+3338nVucT8Wd+BJnvfnlevO/bzEYrEQAOSHOUOI6eH8i78A4Uvc/mzZq9FQLxUUFLyek5NzuLCw8LX8/Pw3RCLRIZFIFNXf379veXl578LCQoTRaAw3m80RBoNhDwcL4oB2u73Vs+HF6sNv3GumGS+9vu6ladrndDgYh8PBuly0n6Zpv8vlYpxOJ+um3T6Px+N1u93crnvW12G32yfJ0ODANkLIdufqr0oAsMqFfnt3Lv7lMNzj9bhvE9uaO5gzNC8uK2xuwNqW7V3q/JCdtc+zi4vz7Nr9Gdb1eJWlnRssyzKs3+9n4QVrMT1iFe3t7OqqjfX5nL5l2gOjza4lGY2TwedtIMekqnZBwzhW2k76jK1ZeLcrFS03Psb3MbEYvzwMdeO9gIrX4cHijVno+yh8UiHGV3cqob+b5+fduovkIY2ORGWXc5G38S92dvJqx2ANAIWIV78Pmbwcc0d5GKkbgOrSNAavNUIjV2Cp+TvoVZOQfFEPSnMBWk2mnz+hh2CY0hHRiDUoukxJ0qTqtuTaMc7QyxnGqTN/ByYkYaR+AH1Ns7hSlIuuigqsyB9gSjUBcU0ttFQpbms/8Kf8AXynoGErISRYIFZ2JP9pmIU41V+BvVdncb2sCL3SalhlhqeAJdBRQn/K+BT4HDAy4cTzPwEktaqrnfcMYEtJIXokUlhlP/49cFf4voj0obVAZN7Tkf8r8EB04g5CyA7BRWVnct2t/2+oBrZEnZORNMkmGR4+XcGdTVCquOuZpfwjYEzx1a0IlNK9OaXkjq4EHbk0RdIkKsWmRE5v1ARzd8iv7FA+KWXD2JrFxKoyGJm8jJlLSGJG6gaY3iszTEtJAdMjkTBWmYGZ6p5gxDW1DEWVMDpK6A0AhyiKZHfOBb1ddZOkV/cEWrYpcmCSCwM/pbWtHIajSRitH0Rf07e4XlqIXqkUttYH0KsnUfV5HXTaUtzRCcGfvAfBTe3X5Pw0tpydB+F9KmtIrB54bGk5Pm9ozjC9155ubr52wTgdm2Dur+kxKxv05svFH5k6KipNj5rum7WKYdNnYql5bLTYNDaaYUwaoqy8L0e7yZN5bv+hmJ0HjwjDGk69ueuc4NXQ/SmvhIlyBTtPHXg57ExyTsixxLOh/LeiQ7Li4kPyE86EFZ3I2x0TGx+alxezOzMjMuxgZvaeyOOnX/gNDjTpSlOVscEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/331531bb65cc6908f464a6e2e9da132e/38070/output_30_0.png\"\n        srcset=\"/static/331531bb65cc6908f464a6e2e9da132e/c26ae/output_30_0.png 158w,\n/static/331531bb65cc6908f464a6e2e9da132e/6bdcf/output_30_0.png 315w,\n/static/331531bb65cc6908f464a6e2e9da132e/38070/output_30_0.png 451w\"\n        sizes=\"(max-width: 451px) 100vw, 451px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Letâ€™s check some of our prediction</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">fig<span class=\"token punctuation\">,</span> axes <span class=\"token operator\">=</span> plt<span class=\"token punctuation\">.</span>subplots<span class=\"token punctuation\">(</span>ncols<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> nrows<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> figsize <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ninit <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    j <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        ind <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>choices<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">,</span> k <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n        init <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        <span class=\"token keyword\">while</span> j <span class=\"token operator\">&lt;</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>ind<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> k<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">[</span>ind<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cmap<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>cm<span class=\"token punctuation\">.</span>binary<span class=\"token punctuation\">)</span>\n            axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> k<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>set_title<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Prediction : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>pred<span class=\"token punctuation\">[</span>ind<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">,</span> fontsize <span class=\"token operator\">=</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span>\n            axes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> k<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">+</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>axis<span class=\"token punctuation\">(</span><span class=\"token string\">'off'</span><span class=\"token punctuation\">)</span>\n            j <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        j <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nfig<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93510023de4a8aa0b9df3c023f51c209/6295b/output_32_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAADS0lEQVQozxXQa2/bVACA4fwy2KiGJsbaISaE6MQqxIBxGWnG2CQkVIkx2iplg03a1jGE1rJVCNJQGtpG6mLnNDSJ6zRu6pwcH9ttbMeXOL4kduK0/mDUH/BKj94YwzAJlmUv5fP5b3mef4ckye9ardZ5lmV/UBTlAsMwdziOGy0Wi3ckSRqjKGpa1/VzEMIZy7LOAQC+z+fzF3men+I4bjy2u7vLHh4ePqcoymi320/X19d7R0dHSUEQwn6//3Oj0QiiKLqLEAp833+wvb09HA6HSdM0Q9/3kyRJ9jDGT3Vd1x3H+TMmSdJlURTP7+zsXBUE4Wy9Xv/Cdd1TLMtO1mq1EYRQ3DCM0yzLxm3bHuE4LgEhfJXn+QTG+BWapr90HOd1jPFnhmG8GctkMnvtdnthdXVV9X3/CYTQ0XV9liTJwPO8e8vLy76u63MEQXi2bf+UyWT6ruvOEAQxlGV5dmtry2k2m0+y2WyrXC7/EatWqx9gjMd4nv9c1/U3RFGMF4vF1xqNxldBEJypVCrXIYQjsixfxxifoSjqRq/XO8UwzNee550+EVuWdZam6WuCIIzFarVaNQzDhVarpRiGMV+tVi1N02YAAH3Hce6urKz0bNtOptPpbqfTucdxnBcEwXQulxuYpjmzublpMQzzGCEkQwiXTh7eNE3zsqIot13Xfc+yrGlN0y7QND3H8/zbGxsbSUmS3qJpOuk4zkVBEOb6/f4oRVE/mqY5CgCYhRC+KwjC7U6nMxEDAPyl6/o0wzAvOY6bKhQKBcMwEgCAncFgcHN/f7/s+/4NAEA5CIJbEELKdd1JhBCtKEqiVCr95zjO1OLi4st0Op2MEQTxSFXVW6IovlAUZbJSqaR6vd6VQqGwqmna1Xq9vhIEwccAgL/DMPwUY/yPqqofIoQyURRdIUkyJctyfGlp6QVJkt/EcrncrKIo1/L5/CNN0z4hSfLXg4ODSzzPL6iqOpFOp581m833CYJ45nneBEJosdvtjgMAfk+lUuMIod8ajcZHe3t78xjjeCyVSjW73e5yqVQaCILwvFwuR2EY3hdFMTo+Pp7PZrORZVkPGYaJTNP8RZKkyLbt+2traxHG+AFFUVG73T7p+vV6/d//Ac59rqkeFQn6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/93510023de4a8aa0b9df3c023f51c209/f058b/output_32_0.png\"\n        srcset=\"/static/93510023de4a8aa0b9df3c023f51c209/c26ae/output_32_0.png 158w,\n/static/93510023de4a8aa0b9df3c023f51c209/6bdcf/output_32_0.png 315w,\n/static/93510023de4a8aa0b9df3c023f51c209/f058b/output_32_0.png 630w,\n/static/93510023de4a8aa0b9df3c023f51c209/6295b/output_32_0.png 919w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>looks like our models really doing good for predicting test data</p>\n<h1>Conclusions</h1>\n<p>Based on our CV scores itâ€™s lower than <a href=\"https://www.kaggle.com/cdeotte\">Chris Deotte</a> kernel <a href=\"https://www.kaggle.com/cdeotte/25-million-images-0-99757-mnist\">here</a> with 0.99757 on validation accuracy on the same model architecture. So hereâ€™s the point:</p>\n<blockquote>\n<p>GPU do better job in this task [Expected] while TPU give you lower accuracy but faster since weâ€™d train 15 CNNs model on 45 epochs in less than one hour.</p>\n</blockquote>\n<h1>References</h1>\n<ol>\n<li>25 Million Images! [0.99757] MNIST <a href=\"https://www.kaggle.com/cdeotte/25-million-images-0-99757-mnist\">Link</a></li>\n<li>Introduction to CNN Keras - 0.997 (top 6%) <a href=\"https://www.kaggle.com/yassineghouzam/introduction-to-cnn-keras-0-997-top-6\">Link</a></li>\n</ol>","frontmatter":{"title":"MNIST Digit Classifier Using Keras, Tensorflow, and TPU","date":"August 25, 2020","description":"Building MNIST Digit Classifier Model Using Keras, Tensorflow, and TPU"}},"previous":{"fields":{"slug":"/machine-translation-en-jp-seq2seq-tf/"},"frontmatter":{"title":"Machine Translation English to Japanese with Seq2Seq & Tensorflow"}},"next":{"fields":{"slug":"/bdc-main-notebook/"},"frontmatter":{"title":"Hoax Classification - BDC Satria Data 2020"}}},"pageContext":{"id":"20ac24b9-a52d-51d4-be97-2e3ed610e572","previousPostId":"461be79d-3ea2-5bb6-b8f1-c4460049fd52","nextPostId":"561f5bfb-4867-5eae-b7db-fcfe793d9e0d"}},"staticQueryHashes":["3000541721","3274528899"]}