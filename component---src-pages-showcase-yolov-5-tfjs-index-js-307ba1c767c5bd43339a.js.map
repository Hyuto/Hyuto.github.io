{"version":3,"file":"component---src-pages-showcase-yolov-5-tfjs-index-js-307ba1c767c5bd43339a.js","mappings":"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","sources":["webpack://Hyuto.github.io/./node_modules/@react-icons/all-files/fa/FaWindowClose.js","webpack://Hyuto.github.io/./src/pages/showcase/yolov5-tfjs/index.js","webpack://Hyuto.github.io/./src/pages/showcase/yolov5-tfjs/yolov5-tfjs.module.scss"],"sourcesContent":["// THIS FILE IS AUTO GENERATED\nvar GenIcon = require('../lib').GenIcon;\n\nmodule.exports.FaWindowClose = function FaWindowClose(props) {\n  return GenIcon({\n    \"tag\": \"svg\",\n    \"attr\": {\n      \"viewBox\": \"0 0 512 512\"\n    },\n    \"child\": [{\n      \"tag\": \"path\",\n      \"attr\": {\n        \"d\": \"M464 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-83.6 290.5c4.8 4.8 4.8 12.6 0 17.4l-40.5 40.5c-4.8 4.8-12.6 4.8-17.4 0L256 313.3l-66.5 67.1c-4.8 4.8-12.6 4.8-17.4 0l-40.5-40.5c-4.8-4.8-4.8-12.6 0-17.4l67.1-66.5-67.1-66.5c-4.8-4.8-4.8-12.6 0-17.4l40.5-40.5c4.8-4.8 12.6-4.8 17.4 0l66.5 67.1 66.5-67.1c4.8-4.8 12.6-4.8 17.4 0l40.5 40.5c4.8 4.8 4.8 12.6 0 17.4L313.3 256l67.1 66.5z\"\n      }\n    }]\n  })(props);\n};","import React, { useState, useEffect, useRef } from \"react\";\nimport * as tf from \"@tensorflow/tfjs\";\nimport Layout from \"templates/showcase\";\nimport Loader from \"components/loader/loader\";\nimport { FaWindowClose } from \"@react-icons/all-files/fa/FaWindowClose\";\nimport labels from \"./labels.json\";\nimport metadata from \"showcase/yolov5-tfjs.json\";\nimport * as style from \"./yolov5-tfjs.module.scss\";\n\ntf.enableProdMode();\n\nconst YOLOv5OD = () => {\n  const [model, setModel] = useState(null);\n  const [webcam, setWebcam] = useState(\"close\");\n  const [lcimage, setLCImage] = useState(\"close\");\n  const [loading, setLoading] = useState(\"loading\");\n  const [threshold, setThreshold] = useState(0.35);\n  const [aniId, setAniId] = useState(null);\n  const inputImage = useRef(null);\n  const imageRef = useRef(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  const openWebcam = () => {\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      navigator.mediaDevices\n        .getUserMedia({\n          audio: false,\n          video: {\n            facingMode: \"environment\",\n          },\n        })\n        .then((stream) => {\n          window.localStream = stream;\n          videoRef.current.srcObject = stream;\n          setWebcam(\"open\");\n        });\n    } else alert(\"Can't open Webcam!\");\n  };\n\n  const closeWebcam = () => {\n    if (videoRef.current.srcObject) {\n      videoRef.current.srcObject = null;\n      window.localStream.getTracks().forEach((track) => {\n        track.stop();\n      });\n      setWebcam(\"close\");\n    } else alert(\"Please open Webcam first!\");\n  };\n\n  const renderPrediction = (boxes_data, scores_data, classes_data) => {\n    const ctx = canvasRef.current.getContext(\"2d\");\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); //clean canvas\n\n    const font = `18px sans-serif`;\n    ctx.font = font;\n    ctx.textBaseline = \"top\";\n\n    for (let i = 0; i < scores_data.length; ++i) {\n      if (scores_data[i] > threshold) {\n        let [x1, y1, x2, y2] = boxes_data.slice(i * 4, (i + 1) * 4);\n        x1 *= canvasRef.current.width;\n        x2 *= canvasRef.current.width;\n        y1 *= canvasRef.current.height;\n        y2 *= canvasRef.current.height;\n        const width = x2 - x1;\n        const height = y2 - y1;\n        const klass = labels[classes_data[i]];\n        const score = (scores_data[i] * 100).toFixed(1);\n\n        // Draw the bounding box.\n        ctx.strokeStyle = \"#00FF00\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(x1, y1, width, height);\n\n        // Draw the label background.\n        ctx.fillStyle = \"#00FF00\";\n        const textWidth = ctx.measureText(klass + \" - \" + score + \"%\").width;\n        const textHeight = parseInt(font, 10); // base 10\n        ctx.fillRect(x1 - 1, y1 - (textHeight + 2), textWidth + 2, textHeight + 2);\n\n        // Draw labels\n        ctx.fillStyle = \"#ffffff\";\n        ctx.fillText(klass + \" - \" + score + \"%\", x1 - 1, y1 - (textHeight + 2));\n      }\n    }\n  };\n\n  const detectFrame = () => {\n    tf.engine().startScope();\n    let [modelWidth, modelHeight] = model.inputs[0].shape.slice(1, 3);\n    const input = tf.tidy(() => {\n      return tf.image\n        .resizeBilinear(tf.browser.fromPixels(videoRef.current), [modelWidth, modelHeight])\n        .div(255.0)\n        .expandDims(0);\n    });\n\n    model.executeAsync(input).then((res) => {\n      const [boxes, scores, classes] = res.slice(0, 3);\n      const boxes_data = boxes.dataSync();\n      const scores_data = scores.dataSync();\n      const classes_data = classes.dataSync();\n      renderPrediction(boxes_data, scores_data, classes_data);\n      tf.dispose(res);\n    });\n\n    const reqId = requestAnimationFrame(detectFrame);\n    setAniId(reqId);\n    tf.engine().endScope();\n  };\n\n  const detectImage = () => {\n    tf.engine().startScope();\n    let [modelWidth, modelHeight] = model.inputs[0].shape.slice(1, 3);\n    const input = tf.tidy(() => {\n      return tf.image\n        .resizeBilinear(tf.browser.fromPixels(imageRef.current), [modelWidth, modelHeight])\n        .div(255.0)\n        .expandDims(0);\n    });\n\n    model.executeAsync(input).then((res) => {\n      const [boxes, scores, classes] = res.slice(0, 3);\n      const boxes_data = boxes.dataSync();\n      const scores_data = scores.dataSync();\n      const classes_data = classes.dataSync();\n      renderPrediction(boxes_data, scores_data, classes_data);\n      tf.dispose(res);\n    });\n    tf.engine().endScope();\n  };\n\n  useEffect(() => {\n    tf.loadGraphModel(`${window.location.origin}/model/yolov5n_web_model/model.json`).then(\n      (yolov5) => {\n        // Warmup the model before using real data.\n        yolov5.executeAsync(tf.zeros(yolov5.inputs[0].shape)).then((warmupResult) => {\n          warmupResult.forEach((element) => {\n            element.dataSync();\n          });\n          tf.dispose(warmupResult);\n\n          setModel(yolov5);\n          setLoading(\"ready\");\n          tf.setBackend(\"webgl\");\n        });\n      }\n    );\n  }, []);\n\n  return (\n    <Layout title={metadata.title} description={metadata.description}>\n      <div className={style.YOLOWrapper}>\n        <div className={style.title}>\n          <h2>{metadata.title}</h2>\n          <p>{metadata.description}</p>\n        </div>\n        <div className={style.content}>\n          <Loader style={{ display: loading === \"ready\" ? \"none\" : null }}>Loading model...</Loader>\n          <div className={style.main}>\n            <video\n              style={{ display: webcam === \"open\" ? \"block\" : \"none\" }}\n              autoPlay\n              playsInline\n              muted\n              ref={videoRef}\n            />\n            <img style={{ display: lcimage === \"open\" ? \"block\" : \"none\" }} ref={imageRef} />\n            <canvas\n              width={852}\n              height={480}\n              style={{\n                display: webcam === \"open\" || lcimage === \"open\" ? \"block\" : \"none\",\n                position: \"absolute\",\n                top: \"0\",\n                left: \"0\",\n              }}\n              ref={canvasRef}\n            />\n            {lcimage === \"open\" ? (\n              <FaWindowClose\n                size={30}\n                color=\"black\"\n                className={style.close}\n                onClick={() => {\n                  const ctx = canvasRef.current.getContext(\"2d\");\n                  const src = imageRef.current.src;\n                  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                  inputImage.current.value = \"\";\n                  imageRef.current.src = \"\";\n                  window.URL.revokeObjectURL(src);\n                  setLCImage(\"close\");\n                }}\n              />\n            ) : null}\n          </div>\n          <div className={style.btnWrapper}>\n            <input\n              type=\"file\"\n              ref={inputImage}\n              accept=\"image/*\"\n              style={{ display: \"none\" }}\n              onChange={(e) => {\n                const ctx = canvasRef.current.getContext(\"2d\");\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                const f = e.target.files[0];\n                const src = window.URL.createObjectURL(f);\n\n                if (imageRef.current.src === \"\") window.URL.revokeObjectURL(imageRef.current.src);\n                imageRef.current.src = src;\n                imageRef.current.onload = function () {\n                  detectImage();\n                  setLCImage(\"open\");\n                };\n              }}\n            />\n            <button\n              disabled={webcam === \"open\"}\n              onClick={() => {\n                inputImage.current.click();\n              }}\n            >\n              Open Local Image\n            </button>\n\n            <button\n              disabled={lcimage === \"open\"}\n              onClick={() => {\n                if (webcam === \"close\") {\n                  openWebcam();\n                  videoRef.current.onloadedmetadata = () => {\n                    detectFrame();\n                  };\n                } else {\n                  cancelAnimationFrame(aniId);\n                  setAniId(null);\n                  closeWebcam();\n                }\n              }}\n            >\n              {webcam === \"open\" ? \"Close\" : \"Open\"} Webcam\n            </button>\n          </div>\n        </div>\n      </div>\n    </Layout>\n  );\n};\n\nexport default YOLOv5OD;\n","// extracted by mini-css-extract-plugin\nexport var YOLOWrapper = \"yolov5-tfjs-module--YOLOWrapper--18avy\";\nexport var title = \"yolov5-tfjs-module--title--3YIMQ\";\nexport var content = \"yolov5-tfjs-module--content--3yvli\";\nexport var main = \"yolov5-tfjs-module--main--3DtK8\";\nexport var close = \"yolov5-tfjs-module--close--1jjII\";\nexport var btnWrapper = \"yolov5-tfjs-module--btnWrapper--3KLOo\";\nexport var prediction = \"yolov5-tfjs-module--prediction--1zD4t\";"],"names":["GenIcon","module","exports","props","tf","useState","model","setModel","webcam","setWebcam","lcimage","setLCImage","loading","setLoading","threshold","aniId","setAniId","inputImage","useRef","imageRef","videoRef","canvasRef","renderPrediction","boxes_data","scores_data","classes_data","ctx","current","getContext","clearRect","canvas","width","height","font","textBaseline","i","length","slice","x1","y1","x2","y2","klass","labels","score","toFixed","strokeStyle","lineWidth","strokeRect","fillStyle","textWidth","measureText","textHeight","parseInt","fillRect","fillText","detectFrame","startScope","inputs","shape","modelWidth","modelHeight","input","div","expandDims","executeAsync","then","res","boxes","scores","classes","dataSync","reqId","requestAnimationFrame","endScope","useEffect","window","location","origin","yolov5","warmupResult","forEach","element","title","metadata","description","className","style","display","autoPlay","playsInline","muted","ref","position","top","left","FaWindowClose","size","color","onClick","src","value","URL","revokeObjectURL","type","accept","onChange","e","f","target","files","createObjectURL","onload","detectImage","disabled","click","navigator","mediaDevices","getUserMedia","audio","video","facingMode","stream","localStream","srcObject","alert","onloadedmetadata","cancelAnimationFrame","getTracks","track","stop"],"sourceRoot":""}